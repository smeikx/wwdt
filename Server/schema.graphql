scalar Datetime # milliseconds since 1970-01-01, 00:00:00 UTC
scalar URL # String
scalar ProjectRole # String
scalar SessionRole # String

union Role = ProjectRole | SessionRole
union Contribution = Upload | Mark | Arrangement


type Project
{
	id: ID!
	title: String!
	creationTime: Datetime!
	description: String
	sessions: [Session!]
	contributors: [Contributor!]
}

input Project
{
	title: String!
	description: String
}


# sequential parts of one session
type Episode
{
	start: Datetime!
	end: Datetime!
	marks: [Mark!]
	uploads: [Upload!]
}

type Session
{
	id: ID!
	title: String!
	description: String
	start: Datetime!
	end: Datetime!
	contributors: [Contributor!]
	episodes: [Episode!]
	markers: [Marker!]
	uploads: [Upload!]
	recordings: [Recording!]
	arrangements: [Arrangement!]
}


type Recording
{
	id: ID!
	url: URL!
	creationTime: Datetime!
	duration: Int!
}


type ArrangementCoordinate
{
	x: Int!
	y: Int!
}

input ArrangementCoordinate
{
	x: Int!
	y: Int!
}


type ArrangedMark
{
	mark: Mark!
	position ArrangementCoordinate!
	creator: Contributor!
}

type ArrangedConnection
{
	from: ArrangementCoordinate!
	to: ArrangementCoordinate!
	creator: Contributor!
}

type ArrangedLabel
{
	title: String!
	description: String
	position: ArrangementCoordinate!
	creator: Contributor!
}

type Arrangement
{
	title: String!
	description: String
	creator: Contributor!
	contributors: [Contributor]
	marks: [ArrangedMark!]
	connections: [ArrangedConnection!]
	labels: [ArrangedLabel!]
}


type Contributor
{
	id: ID!
	email: String!
	forename: String!
	surname: String
	projectRole: Role
	sessionRole: Role
	uploads: [Upload!]
	marks: [Mark!]
	arrangements: [Arrangement!]
	sessions: [Session!]
}

enum MediaType
{
	AUDIO
	VIDEO
	TEXT
	UNKNOWN
}

type Upload
{
	id: ID!
	creator: Contributor!
	uploadTime: Datetime!
	uploadName: String!
	displayName: String!
	url: URL!
	mediaType: MediaType!
	contributors: [Contributor!]
}

type Mark
{
	id: ID!
	title: String!
	description: String
	tags: [String!]
	uploads: [Upload!]
	frameCoordinates: [FrameCoordinate!]
	creator: Contributor!
	contributors: [Contributor!]
}

# between 0 and 1; relative to the upper left corner
type FrameCoordinate
{
	x: Float! 
	y: Float!
}


type Recorder
{
	id: ID!
	name: String!
	description: String
}


type Query
{
	runningSession: URL
	recorders: [Recorder!]
	projects (): [Project!]
	project (projectId: ID!): Project!
	session (sessionId: ID!): Session!
	mark (markId: ID!): Mark!
	arrangement (arrangementId: ID!): Arrangement!
	publicUploads (sessionId: ID!): [Upload!]
	privateUploads (): [Upload!]
}


type Mutation
{
# PROJECT ##########################
	createProject (
		title: String = "",
		description: String = "",
	): Project!

# SESSION ##########################
	createSession (
			title: String = "",
			description: String = "",
			contributors: [ID!],
		): Session!

	runSession (
		id: ID!
	): Boolean!

	haltSession (
		id: ID!
	): Boolean!

# CONTRIBUTORS ##########################
	addContributors (
		sessionId: ID!,
		contributorIds: [ID!]
	): ID!

	createContributor (
		email: String!,
		forename: String!,
		surname: String,
		projectRole: ProjectRole,
		sessionRole: Sessionrole
	): Contributor!

	assignProjectRole (
		contributorId: ID!,
		roleId: ID!
	): Boolean!

	assignSessionRole (
		contributorId: ID!,
		roleId: ID!
	): Boolean!

# MARK ##########################
	createMark (
		title: String = null,
		description: String = null,
		tags: [String!] = null,
		uploads: [ID!] = null,
		frameCoordinate: FrameCoordinate = null
	): Mark!

# ARRANGEMENTS ##########################
	createArrangement (
		session: ID!,
		title: String = null
		description: String = null
		contributors: [Contributor!]
	): Arrangement!

	arrangeMark (
		arrangementId: ID!,
		markId: ID!,
		coordinate: ArrangementCoordinate!
	): Boolean!

	arrangeLabel (
		arrangementId: ID!,
		title: String!,
		description: String!,
		coordinate: ArrangementCoordinate!
	): Boolean!

	arrangeConnection (
		arrangementId: ID!,
		fromCoordinate: ArrangementCoordinate!,
		toCoordinate: ArrangementCoordinate!
	): Boolean!

# RECORDING ##########################
	startRecording (
		devices: [ID!]!
	): Boolean!

	stopRecording (
		devices: [ID!]!
	): Boolean!

# PERMISSIONS ##########################
	addPermission (
		contributionId: ID!, # Upload, Mark, Arrangement
		contributorId: ID!
	): Boolean!

	removePermission (
		contributionId: ID!, # Upload, Mark, Arrangement
		contributorId: ID!
	): Boolean!
}

